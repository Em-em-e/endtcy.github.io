<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>CODER-LI的博客</title>
    <meta name="keywords" content="个人博客,李亮个人博客,李亮" />
    <meta name="description" content="杨青个人博客，是一个站在web前端设计之路的女程序员个人网站，提供个人博客模板免费资源下载的个人原创网站。" />
    <link href="css/base.css" rel="stylesheet">
    <link href="css/share.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="js/modernizr.js"></script>
    <![endif]-->
</head>
<body>
<header>
    <div id="logo"><a href="/"></a></div>
  <nav class="topnav" id="topnav"><a href="index.html"><span>首页</span><span class="en">Protal</span></a><a href="about.html"><span>关于我</span><span class="en">About</span></a><a href="moodlist.action"><span>碎言碎语</span><span class="en">Doing</span></a><a href="share.html"><span>模板分享</span><span class="en">Share</span></a><a href="knowledge.html"><span>学无止境</span><span class="en">Learn</span></a><a href="book.html"><span>留言版</span><span class="en">Gustbook</span></a>
  </nav>
</header>
<article class="blogs">
    <h1 class="t_nav"><span>好咖啡要和朋友一起品尝，好“文章”也要和同样喜欢它的人一起分享。 </span><a href="/" class="n1">网站首页</a><a href="/" class="n2">文章分享</a></h1>
    <div class="newblog left">
        <h1 class="c_titile">【框架技术】Struts2自定义类型转换器 </h1>
        <p class="box_c"><span class="d_time">发布时间：2016-01-28 </span><span> 编辑：<a href="http://user.qzone.qq.com/731556624/">李亮 </a></span></p><br><br>

            
 <div class="markdown_views">

<p><strong>一、类型转换器定义：</strong></p>

<p>众所周知，java有八大基本的类型，struts2能对这八大基本类型以及String、Date等常用类型提供自动转换。</p>

<p>但是，仅仅这些远远不能满足我们的需要。</p>

<p><strong>原因：</strong>因为页面中的类型都是属于字符串类型的，而java是一种强类型语言，这时候我们需要把输入的字符串转型成为相应的类型。</p>

<p>在类型转换器的定义中也分为两种：</p>

<p><strong>局部类型转换器：</strong>对某个action转换类型起作用。</p>

<p><strong>全局类型转换器：</strong>对所有action转换类型起作用。</p>

<hr>

<p><strong>二、局部类型转换器：</strong></p>

<p>这里用一个日期来举例子：</p>

<p>比如我们在页面输入20140828，如果Action类的属性是Date类型的，则它不能够正确接收到这个时间值。</p>

<p>如果我们输入2014-08-28，则Action类的Date类型的属性就可以正确接收到这个时间值。</p>

<p>所以，这个时候我们就需要用到类型转换了。</p>

<p>首先我们需要定义一个简单的Action类继承ActionSupport类：</p>

<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> cn.action;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> com.opensymphony.xwork2.ActionSupport;
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorldAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionSupport</span>{</span>
    <span class="hljs-keyword">private</span> Date birthday;
    <span class="hljs-keyword">public</span> Date <span class="hljs-title">getBirthday</span>() {
        System.out.println(<span class="hljs-string">"get:"</span>+birthday);
        <span class="hljs-keyword">return</span> birthday;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBirthday</span>(Date birthday) {
        System.out.println(<span class="hljs-string">"set:"</span>+birthday);
        <span class="hljs-keyword">this</span>.birthday = birthday;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">excute</span>(){
        <span class="hljs-keyword">return</span> SUCCESS;
    }    
}</code></pre>

<p>然后，我们需要去通过实现TypeCoverter接口或者继承DefaultTypeConverter实现类（该类实现了TypeCoverter接口）来实现自己的类型转换器（重写convertValue方法即可）。</p>



<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">package</span> cn.type.Converter;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.text.ParseException;
<span class="hljs-keyword">import</span> java.text.SimpleDateFormat;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> com.opensymphony.xwork2.conversion.impl.DefaultTypeConverter;
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DateTypeConverter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultTypeConverter</span> {</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title">convertValue</span>(Map arg0, Object value,Class toType) {
        SimpleDateFormat dateFormat = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"yyyyMMdd"</span>);
        <span class="hljs-keyword">try</span> {

            <span class="hljs-keyword">if</span> (toType == Date.class) {<span class="hljs-comment">// 当字符串向Date类型转换时</span>
                String[] params = (String[]) value;<span class="hljs-comment">// Request.getParameterValues()</span>
                System.out.println(<span class="hljs-string">"value="</span>+value);
                System.out.println(<span class="hljs-string">"时间："</span>+dateFormat.parse(params[<span class="hljs-number">0</span>]));
                <span class="hljs-keyword">return</span> dateFormat.parse(params[<span class="hljs-number">0</span>]);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (toType == String.class) {<span class="hljs-comment">// 当Date转换成字符串时</span>
                System.out.println(value);
                Date date = (Date) value;
                <span class="hljs-keyword">return</span> dateFormat.format(date);
            }
        } <span class="hljs-keyword">catch</span> (java.text.ParseException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
}</code></pre>

<p>最后，我们需要把这个类型转换器注册到WEB应用上边：</p>

<p>在需要生效的Action类的包下新建ActionName-conversion.properties该文件,其中 ActionName是需要转换生效的Action的类名，后面的-conversion固定。</p>

<p>内容: 待转换的action中的属性名=类型转换器的全类名。 注意：类型转换器是需要加包名，而且最后不能加标点符号</p>

<p>如：date=com.DateTypeConvert</p>

<p>我们这里需要建立的是：HelloWorldAction-conversion.properties</p>



<pre class="prettyprint"><code class=" hljs avrasm">birthday=cn<span class="hljs-preprocessor">.type</span><span class="hljs-preprocessor">.Converter</span><span class="hljs-preprocessor">.DateTypeConverter</span></code></pre>

<hr>

<p><strong>三、全局类型转换器：</strong></p>

<p>局部类型转换器仅仅对指定的Action的指定属性进行转换。</p>

<p>全局类型转换器对所有Action的特定类型进行转换。</p>

<p>在src目录下新建xwork-conversion.properties，该文件的内容是待转换的类=转换器的名字，即com.shengsiyuan.bean.User=com.shengsiyuan.converter.UserConverter2</p></div>
            
            
    </div>
    <aside class="right">
        <div class="rnav">
            <h2>栏目导航</h2>
            <ul>
                <li><a href="/download/" target="_blank">个人博客模板</a></li>
                <li><a href="/newsfree/" target="_blank">国外Html5模板</a></li>
                <li><a href="/download/" target="_blank">企业网站模板</a></li>
                <li><a href="/newsfree/" target="_blank">作品展示</a></li>
            </ul>
        </div>
        <div class="news">
            <h3>
                <p>最新<span>模板</span></p>
            </h3>
            <ul class="rank">
                <li><a href="/" title="Column 三栏布局 个人网站模板" target="_blank">Column 三栏布局 个人网站模板</a></li>
                <li><a href="/" title="with love for you 个人网站模板" target="_blank">with love for you 个人网站模板</a></li>
                <li><a href="/" title="免费收录网站搜索引擎登录口大全" target="_blank">免费收录网站搜索引擎登录口大全</a></li>
                <li><a href="/" title="做网站到底需要什么?" target="_blank">做网站到底需要什么?</a></li>
                <li><a href="/" title="企业做网站具体流程步骤" target="_blank">企业做网站具体流程步骤</a></li>
                <li><a href="/" title="建站流程篇――教你如何快速学会做网站" target="_blank">建站流程篇――教你如何快速学会做网站</a></li>
                <li><a href="/" title="box-shadow 阴影右下脚折边效果" target="_blank">box-shadow 阴影右下脚折边效果</a></li>
                <li><a href="/" title="打雷时室内、户外应该需要注意什么" target="_blank">打雷时室内、户外应该需要注意什么</a></li>
            </ul>
            <h3 class="ph">
                <p>点击<span>排行</span></p>
            </h3>
            <ul class="paih">
                <li><a href="/" title="Column 三栏布局 个人网站模板" target="_blank">Column 三栏布局 个人网站模板</a></li>
                <li><a href="/" title="withlove for you 个人网站模板" target="_blank">with love for you 个人网站模板</a></li>
                <li><a href="/" title="免费收录网站搜索引擎登录口大全" target="_blank">免费收录网站搜索引擎登录口大全</a></li>
                <li><a href="/" title="做网站到底需要什么?" target="_blank">做网站到底需要什么?</a></li>
                <li><a href="/" title="企业做网站具体流程步骤" target="_blank">企业做网站具体流程步骤</a></li>
            </ul>
        </div>
        <div class="visitors">
            <h3><p>转载分享</p></h3>
        </div>
        <!-- Baidu Button BEGIN -->
        <div id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare"><a class="bds_tsina"></a><a class="bds_qzone"></a><a class="bds_tqq"></a><a class="bds_renren"></a><span class="bds_more"></span><a class="shareCount"></a></div>
        <script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6574585" ></script>
        <script type="text/javascript" id="bdshell_js"></script>
        <script type="text/javascript">
            document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
        </script>
        <!-- Baidu Button END -->
    </aside>
</article>
<footer>
    <p> <a href="http://user.qzone.qq.com/731556624" target="_blank">Design by Liliang </a> 鄂ICP备15021396号</p>
</footer>
<script src="js/silder.js"></script>
</body>
</html>
